<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SlickGrid AJAX Example</title>
    <link rel="stylesheet" href="/js/slickgrid/dist/styles/css/slick.grid.css" type="text/css"/>
    <link rel="stylesheet" href="/js/slickgrid/dist/styles/css/slick-alpine-theme.css" type="text/css"/>
    
    <script src="/js/jquery-3.7.1.min.js"></script>
    <script src="/js/slickgrid/lib/jquery.event.drag-2.3.0.js"></script>
    
    <script src="/js/slickgrid/dist/browser/slick.core.js"></script>
    <script src="/js/slickgrid/dist/browser/slick.interactions.js"></script>
    <script src="/js/slickgrid/dist/browser/slick.grid.js"></script>
    <script src="/js/slickgrid/dist/browser/plugins/slick.autotooltips.js"></script>
	<script src="/js/slickgrid/dist/browser/plugins/slick.cellrangedecorator.js"></script>
	<script src="/js/slickgrid/dist/browser/plugins/slick.cellrangeselector.js"></script>
	<script src="/js/slickgrid/dist/browser/plugins/slick.cellexternalcopymanager.js"></script>
	<script src="/js/slickgrid/dist/browser/plugins/slick.cellselectionmodel.js"></script>
	<script src="/js/slickgrid/dist/browser/slick.editors.js"></script>
	<script src="/js/slickgrid/dist/browser/slick.formatters.js"></script>
    
    <style>
	.slick-header-columns {
		/* flex-grow: 1 if we want to align sort icons to the right */
	    --alpine-header-name-flex-grow: 1;
	    }
    .slick-cell.copied {
      background: blue;
      background: rgba(0, 0, 255, 0.2);
      transition: 0.5s background;
    }
    /** override slick-cell to make it look like Excel sheet */
    .slick-container {
      --alpine-header-column-height: 20px;
      --alpine-header-font-weight: 500;
      --alpine-cell-border-width: 0 1px 1px 0;
      --alpine-cell-border-color: #d4d4d4;
    }
  	</style>
    <script>
        $(document).ready(function() {
            console.log("Document is ready.");
            $("#send").click(getGocInfo);
            $("input").on("keyup", function(key) {
                if (key.keyCode == 13) {
                    getGocInfo();
                }
            });
        });

        function getGocInfo() {
            console.log("Sending AJAX request...");
            $.ajax({
                type: 'post',
                url: '/MybatisTestSelectList',
                async: true,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({
                    accgModlCd: $("#accgModlCd").val(),
                    cohtYear: $("#cohtYear").val(),
                    prtpCd: $("#prtpCd").val(),
                    erpfGrpCd: $("#erpfGrpCd").val()
                }),
                success: function(data) {
                    console.log("AJAX request successful. Data received:", data);
                    if (data && data.length > 0) {
                        // 컬럼 생성
                        var newRowIds = 0;

					    var pluginOptions = {
							clipboardCommandHandler: function(editCommand){ undoRedoBuffer.queueAndExecuteCommand.call(undoRedoBuffer,editCommand); },
							readOnlyMode : false,
							includeHeaderWhenCopying : false,
							newRowCreator: function(count) {
								for (var i = 0; i < count; i++) {
									var item = {
										id: "newRow_" + newRowIds++
									}
								grid.getData().addItem(item);
								}
					    	}
					  	};
					  	
                        var columns = [];
                        var keys = Object.keys(data[0]);
                        for (var i = 0; i < keys.length; i++) {
                            columns.push({ id: keys[i], name: keys[i], field: keys[i], sortable: true, editor: Slick.Editors.Text });
                        }

                        // 그리드 옵션
                        var options = {
                            enableCellNavigation: true,
                            enableColumnReorder: false,
                            forceFitColumns: true,
                            multiColumnSort: true,
                            numberedMultiColumnSort: true,
    						tristateMultiColumnSort: true,
    						sortColNumberInSeparateSpan: true,
                            enableAutoSizeColumns: true,
                            editable: true,
						    enableAddRow: true,
						    asyncEditorLoading: false,
						    autoEdit: false,
						    autoEditNewRow: false
                        };

                        // 그리드 초기화 및 데이터 로드
                        console.log("Initializing SlickGrid...");
                        var grid = new Slick.Grid("#myGrid", data, columns, options);
                        
                        // when "onBeforeSort" returns false, the "onSort" won't execute (for example a backend server error while calling backend query to sort)
					    grid.onBeforeSort.subscribe(function (e, args) {
					      return true;
					    });
                        
                		// 정렬
						grid.onSort.subscribe(function (e, args) {
							
							var cols = args.sortCols;
				
							data.sort(function (dataRow1, dataRow2) {
								for (var i = 0, l = cols.length; i < l; i++) {
									var field = cols[i].sortCol.field;
									var sign = cols[i].sortAsc ? 1 : -1;
									var value1 = dataRow1[field], value2 = dataRow2[field];
									var result = (value1 == value2 ? 0 : (value1 > value2 ? 1 : -1)) * sign;
									if (result != 0) {
										return result;
									}
								}
								return 0;
							});
							grid.invalidate();
							grid.render();
						});
						
						grid.setSelectionModel(new Slick.CellSelectionModel());
					    grid.registerPlugin(new Slick.AutoTooltips());
					
					    // set keyboard focus on the grid
					    grid.getCanvasNode().focus();
					
					    grid.registerPlugin(new Slick.CellExternalCopyManager(pluginOptions));
					    
					    grid.onAddNewRow.subscribe(function (e, args) {
					      var item = args.item;
					      var column = args.column;
					      grid.invalidateRow(data.length);
					      data.push(item);
					      grid.updateRowCount();
					      grid.render();
					    });

                        console.log("SlickGrid initialized.");
                    } else {
                        console.log("No data returned from the server.");
                    }
                },
                error: function(xhr, status, error) {
                    console.error("!!!! ERROR !!!!!", status, error);
                }
            });
        }
    </script>
</head>
<body>
    <form name="form" method="post" action="/MybatisTestSelectList">
        * 조회조건<br/>
        ACCG_MODL_CD : <input type="text" id="accgModlCd" name="accgModlCd" value=""><br/>
        COHT_YEAR : <input type="text" id="cohtYear" name="cohtYear" value=""><br/>
        PRTP_CD : <input type="text" id="prtpCd" name="prtpCd" value=""><br/>
        ERPF_GRP_CD : <input type="text" id="erpfGrpCd" name="erpfGrpCd" value=""><br/>
        <a href="/views/WRK/FIL/WRKFIL001M0.html" target="_self">파일관리</a>
        <a href="/views/WRK/FIL/WRKFIL002M0.html" target="_self">컬럼관리</a>
        <a href="/views/WRK/FIL/WRKFIL003M0.html" target="_self">파일업로드</a>
        <a href="/views/WRK/FIL/WRKFIL004M0.html" target="_self">파일적재이력</a>
        <a href="/views/MST/SYS/MSTSYS001M0.html" target="_self">사용자관리</a>
        <!-- <a href="./views/MST/SYS/MSTSYS002M0.html" target="_self">코드관리</a> -->
        <input type="button" id="send" value="send" />
        <p>&nbsp;</p>
    </form>
    <table align="center">
		<div id="myGrid" style="width:1300px;height:900px;"></div>
	</table>
</body>
</html>
