<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/layout}">
<th:block layout:fragment="content">
  <!-- <div class="page"> -->
  <script src="js/js-tabler/demo-theme.min.js?1692870487"></script>
  <link href="css/common-css.css" rel="stylesheet" />
  <div class="page-wrapper" id="page-wrapper">
    <!-- Main Container -->
    <div class="container" id="container">
      <h2>[[${menuNm}]]</h2>
      <div class="ptag-container">
        <span>[[${navigator}]]</span>
        <!-- page bopdy for the subscription -->
        <div class="page-body">
          <div class="container-xl">
            <div class="row row-cards">
              <!-- Basic Plan Card -->
              <div class="col-sm-6 col-lg-3">
                <div class="card card-md">
                  <div class="card-body text-center">
                    <div class="text-uppercase text-secondary font-weight-medium">
                      Basic
                    </div>
                    <div class="display-5 fw-bold my-3">120만원</div>
                    <ul class="list-unstyled lh-lg">
                      <li><strong>5</strong> Users</li>
                      <li>
                        <!-- Check Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-success" width="24" height="24"
                          viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                          stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                          <path d="M5 12l5 5l10 -10" />
                        </svg>
                        Sharing Tools
                      </li>
                      <li>
                        <!-- X Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-danger" width="24" height="24"
                          viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                          stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                          <path d="M18 6l-12 12" />
                          <path d="M6 6l12 12" />
                        </svg>
                        Design Tools
                      </li>
                      <li>
                        <!-- X Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-danger" width="24" height="24"
                          viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                          stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                          <path d="M18 6l-12 12" />
                          <path d="M6 6l12 12" />
                        </svg>
                        Private Messages
                      </li>
                      <li>
                        <!-- X Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-danger" width="24" height="24"
                          viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                          stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                          <path d="M18 6l-12 12" />
                          <path d="M6 6l12 12" />
                        </svg>
                        Twitter API
                      </li>
                    </ul>
                    <div class="text-center mt-4">
                      <button class="btn btn-primary w-100" id="basicSubscriptionButton"
                        onclick="useBasicSubscription()">Register</a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-lg-3">
                <div class="card card-md">
                  <div class="card-body text-center">
                    <div class="text-uppercase text-secondary font-weight-medium">
                      Premium
                    </div>
                    <div class="display-5 fw-bold my-3">230만원</div>
                    <ul class="list-unstyled lh-lg">
                      <li><strong>20</strong> Users</li>
                      <li>
                        <!-- Check Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-success" width="24" height="24"
                          viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                          stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                          <path d="M5 12l5 5l10 -10" />
                        </svg>
                        Sharing Tools
                      </li>
                      <li>
                        <!-- Check Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-success" width="24" height="24"
                          viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                          stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                          <path d="M5 12l5 5l10 -10" />
                        </svg>
                        Design Tools
                      </li>
                      <li>
                        <!-- X Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-danger" width="24" height="24"
                          viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                          stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                          <path d="M18 6l-12 12" />
                          <path d="M6 6l12 12" />
                        </svg>
                        Private Messages
                      </li>
                      <li>
                        <!-- X Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-danger" width="24" height="24"
                          viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                          stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                          <path d="M18 6l-12 12" />
                          <path d="M6 6l12 12" />
                        </svg>
                        Twitter API
                      </li>
                    </ul>
                    <div class="text-center mt-4">
                      <button class="btn btn-primary w-100" id="premiumSubscriptionButton"
                        onclick="usePremiumSubscription()">Register</a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-lg-3">
                <div class="card card-md">
                  <div class="card-body text-center">
                    <div class="text-uppercase text-secondary font-weight-medium">
                      Option Panel:
                    </div>
                    <form id="optionForm">
                      <div class="mb-3">
                        <h3 class="flex-container"><label for="optionSelect">Add User: </label></h3>
                        <select id="optionSelect" class="form-select">
                          <option value="">Loading options ...</option>
                        </select>
                      </div>
                      <ul class="list-unstyled lh-lg">
                        <li><strong>As many you want</strong> (Users)</li>
                        <li>
                          <!-- Check Icon -->
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-success" width="24" height="24"
                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M5 12l5 5l10 -10" />
                          </svg>
                          Sharing Tools
                        </li>
                        <li>
                          <!-- Check Icon -->
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-success" width="24" height="24"
                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M5 12l5 5l10 -10" />
                          </svg>
                          Design Tools
                        </li>
                        <li>
                          <!-- Check Icon -->
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1 text-success" width="24" height="24"
                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M5 12l5 5l10 -10" />
                          </svg>
                          Private Messages
                        </li>
                        <li>

                        </li>
                      </ul>
                      <div class="mt-2 flex-container">
                        <span>Currently selected option:&nbsp;</span>
                        <span id="selectedOption"> None</span>
                      </div>

                      <button type="button" class="btn btn-outline-secondary w-100" onclick="addOption()">
                        Add
                      </button>
                    </form>
                  </div>
                </div>
                </form>
              </div>
              <!-- <div class="col-10">
                    <div class="card card-md">
                      <div class="card-body">
                        <div class="row align-items-center">
                          <div class="col">
                            <h2 class="h3">
                              Enterprise-ready. Reach out for a custom quote.
                            </h2>
                            <p class="m-0 text-secondary">
                              Tabler is designed to work great for large
                              enterprises. Take a look at our feature comparison.
                            </p>
                          </div>
                          <div class="col-auto">
                            <a href="mailto:example@gmail.com" class="btn">Book a demo </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- </div> -->
  <script>
    // Function to fetch all available options and populate the select element
    function fetchOptions() {
      $.ajax({
        type: "GET",
        url: "/ADMSRV001M0SelectAllOptions",
        async: true,
        dataType: "json",
        success: function (data) {
          console.log("Options fetched successfully:", data);
          var $optionSelect = $("#optionSelect");
          $optionSelect.empty();
          if (data.length > 0) {
            $optionSelect.append(
              '<option value="">Select an option</option>'
            );
            $.each(data, function (index, option) {
              // Combine optCd and optDtlsCd as the value
              var value =
                option.optCd +
                "|" +
                option.optDtlsCd +
                "|" +
                option.optDtlsNm +
                "|" +
                option.optDtlsDesc;
              $optionSelect.append(
                '<option value="' +
                value +
                '">' +
                option.optDtlsDesc +
                "</option>"
              );
            });
            console.log("Options added to select element: ", data);
          } else {
            $optionSelect.append(
              '<option value="">No options available</option>'
            );
          }
        },
        error: function (xhr, status, error) {
          console.error("Error fetching options:", status, error);
          $("#optionSelect").html(
            '<option value="">Error loading options</option>'
          );
        },
      });
    }

    // write me function that will retreive the selcted option value's correspodning  optDtlsCd and send it to other cetch call request param value
    function getSelectedOptionValue() {
      var selectedValue = $("#optionSelect").val();
      if (selectedValue === "") {
        alert("Please select an option to add.");
        return;
      }

      // Split the selected value to get optCd and optDtlsCd
      var codes = selectedValue.split("|");
      var optCd = codes[0];
      console.log("Console logging the selectedValue: ", selectedValue);

      console.log("Console logging the optionCode code: ", codes[0]);
      var optDtlsCd = codes[1];
      console.log("Console logging the optioDeatils code: ", codes[1]);
    }

    // Call fetchOptions when the page loads
    $(document).ready(function () {
      fetchOptions();
    });

    // Function to handle "Use" button click for Basic Subscription
    function useBasicSubscription() {
      $.ajax({
        type: "POST",
        url: "/ADMSRV001M0MergeServiceOption",
        async: true,
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        xhrFields: {
          withCredentials: true,
        },
        data: JSON.stringify({
          srvcCd: "01", // Service code for Basic Subscription
        }),
        success: function (data) {
          console.log("Response data:", data);
          if (data.status === "success") {
            alert("Basic Subscription activated successfully.");
            console.log("Basic Subscription activation successful:", data);
            // will update the ui accordingly
            $("#basicSubscriptionButton")
              .text("Current Plan")
              .prop("disabled", true);
            $("#premiumSubscriptionButton")
              .text("Register")
              .prop("disabled", false);
          } else {
            alert("Failed to activate the Basic Subscription service.");
          }
        },
        error: function (xhr, status, error) {
          console.error(
            "Error activating Premium Subscription:",
            xhr.responseText || status,
            error
          );
          alert("Failed to activate Basic Subscription.");
        },
      });
    }

    // Function to handle "Use" button click for Premium Subscription
    function usePremiumSubscription() {
      $.ajax({
        type: "POST",
        url: "/ADMSRV001M0MergeServiceOption",
        async: true,
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        xhrFields: {
          withCredentials: true,
        },
        data: JSON.stringify({
          srvcCd: "02", // Service code for Premium Subscription
        }),
        success: function (data) {
          console.log("Response data:", data);
          if (data.status === "success") {
            alert("Premium Subscription activated successfully.");
            console.log("Premium Subscription activation successful:", data);
            // will update the ui to show the ui accordingly
            $("#premiumSubscriptionButton")
              .text("Current Plan")
              .prop("disabled", true);
            $("#basicSubscriptionButton")
              .text("Register")
              .prop("disabled", false);
          } else {
            alert("Failed to activate the Premium Subscription service.");
          }
        },
        error: function (xhr, status, error) {
          console.error(
            "Error activating Premium Subscription:",
            xhr.responseText || status,
            error
          );
          alert("Failed to activate Premium Subscription.");
        },
      });
    }

    // Function to handle "Add" button click in Option Addition
    function addOption() {
      var selectedValue = $("#optionSelect").val();
      if (selectedValue === "") {
        alert("Please select an option to add.");
        return;
      }

      // Split the selected value to get optCd and optDtlsCd
      var codes = selectedValue.split("|");
      var optCd = codes[0];
      console.log("Console logging the selectedValue: ", codes);

      console.log("Console logging the optionCode code: ", codes[0]);
      var optDtlsCd = codes[1];
      console.log("Console logging the optioDeatils code: ", codes[1]);

      $.ajax({
        type: "POST",
        url: "/ADMSRV001M0UpdateOptionDetails",
        async: true,
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify({
          optCd: optCd, // Option Code
          optDtlsCd: optDtlsCd, // Option Details Code
        }),
        success: function (data) {
          console.log("Response data:", data);
          if (data.status === "success") {
            alert("Option added successfully.");
            console.log("Option addition successful:", data);
            // Update the selected option display
            $("#selectedOption").text(
              $("#optionSelect option:selected").text()
            );
          } else {
            alert("Failed to add option.");
          }
        },
        error: function (xhr, status, error) {
          console.error("Error adding option:", status, error);
          alert("Failed to add option.");
        },
      });
    }

    // Function to fetch and display the user's current subscription info
    function getUserSubscriptionInfo() {
      $.ajax({
        type: "GET",
        url: "/getUserSubscriptionInfo",
        async: true,
        dataType: "json",
        success: function (data) {
          console.log("User subscription info:", data);
          // update the ui based on the user subscription
          if (data && data.length > 0) {
            var subscription = data[0]; // Assuming we hvae only one subscrition
            if (subscription.srvcCd === "01") {
              $("#basicSubscriptionButton")
                .text("Current Plan")
                .prop("disabled", true);
              $("#premiumSubscriptionButton")
                .text("Use")
                .prop("disabled", false);
            } else if (subscription.srvcCd === "02") {
              $("#premiumSubscriptionButton")
                .text("Current Plan")
                .prop("disabled", true);
              $("#basicSubscriptionButton")
                .text("Use")
                .prop("disabled", false);
            } else {
              $("#basicSubscriptionButton")
                .text("Use")
                .prop("disabled", false);
              $("#premiumSubscriptionButton")
                .text("Use")
                .prop("disabled", false);
            }

            // Display the currently selected option
            if (subscription.optDtlsNm) {
              $("#selectedOption").text(subscription.optDtlsNm);
            }
          } else {
            // No subscription info found
            $("#basicSubscriptionButton").text("Use").prop("disabled", false);
            $("#premiumSubscriptionButton")
              .text("Use")
              .prop("disabled", false);
          }
        },
        error: function (xhr, status, error) {
          console.error(
            "Error fetching user subscription info:",
            status,
            error
          );
        },
      });
    }

    // Call getUserSubscriptionInfo when the page loads
    $(document).ready(function () {
      getUserSubscriptionInfo();
    });
  </script>
  <script src="js/utils.js"></script>
</th:block>

</html>