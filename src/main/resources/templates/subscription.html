<!DOCTYPE html>
<html
  lang="ko"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
>
  <head>
    <meta charset="UTF-8" />
    <title>Subscription Management</title>

    <!-- Include Tabler CSS and other dependencies -->
    <link
      rel="stylesheet"
      href="css/jquery-ui-1.13.3/jquery-ui.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="js/slickgrid/dist/styles/css/slick.grid.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="js/slickgrid/dist/styles/css/slick-alpine-theme.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="js/slickgrid/dist/styles/css/slick.grid.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="js/slickgrid/dist/styles/css/slick-alpine-theme.css"
      type="text/css"
    />

    <!-- Tabler Framework CSS Files Import -->
    <link href="css/css-tabler/tabler.min.css?1692870487" rel="stylesheet" />
    <link
      href="css/css-tabler/tabler-flags.min.css?1692870487"
      rel="stylesheet"
    />
    <link
      href="css/css-tabler/tabler-payments.min.css?1692870487"
      rel="stylesheet"
    />
    <link
      href="css/css-tabler/tabler-vendors.min.css?1692870487"
      rel="stylesheet"
    />
    <link href="css/css-tabler/demo.min.css?1692870487" rel="stylesheet" />

    <!-- Custom CSS for This Page -->
    <link href="css/file-css.css" rel="stylesheet" />
    <link href="css/common-css.css" rel="stylesheet" />

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jQuery and Other JS Dependencies -->
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/slickgrid/lib/jquery.event.drag-2.3.0.js"></script>
    <script src="js/slickgrid/dist/browser/slick.core.js"></script>
    <script src="js/slickgrid/dist/browser/slick.interactions.js"></script>
    <script src="js/slickgrid/dist/browser/slick.grid.js"></script>
    <script src="js/slickgrid/dist/browser/plugins/slick.autotooltips.js"></script>
    <script src="js/slickgrid/dist/browser/plugins/slick.cellrangedecorator.js"></script>
    <script src="js/slickgrid/dist/browser/plugins/slick.cellrangeselector.js"></script>
    <script src="js/slickgrid/dist/browser/plugins/slick.cellexternalcopymanager.js"></script>
    <script src="js/slickgrid/dist/browser/plugins/slick.cellselectionmodel.js"></script>
    <script src="js/slickgrid/dist/browser/slick.editors.js"></script>
    <script src="js/slickgrid/dist/browser/slick.formatters.js"></script>
    <script src="js/slickgrid/dist/browser/slick.dataview.js"></script>
    <script src="js/slickgrid/dist/browser/plugins/slick.checkboxselectcolumn.js"></script>
    <script src="js/slickgrid/dist/browser/plugins/slick.rowselectionmodel.js"></script>
    <script src="js/slickgrid/dist/browser/slick.compositeeditor.js"></script>
    <script src="js/slickgrid/dist/browser/controls/slick.pager.js"></script>

    <script src="js/js-tabler/demo-theme.min.js?1692870487"></script>
    <script src="js/js-tabler/tabler.min.js?1692870487" defer></script>
    <script
      src="js/libs-tabler/apexcharts/dist/apexcharts.min.js?1692870487"
      defer
    ></script>
    <script
      src="js/libs-tabler/jsvectormap/dist/js/jsvectormap.min.js?1692870487"
      defer
    ></script>
    <script
      src="js/libs-tabler/jsvectormap/dist/maps/world.js?1692870487"
      defer
    ></script>
    <script
      src="js/libs-tabler/jsvectormap/dist/maps/world-merc.js?1692870487"
      defer
    ></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="js/utils.js" defer></script>
    <script src="js/xlsx.full.min.js"></script>

    <style>
      body {
        font-family: "Inter Var", -apple-system, BlinkMacSystemFont,
          "San Francisco", "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
        background-color: #f4f6f9; /* Light background for contrast */
      }

      .row-cards {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px; /* Space between cards */
        margin-top: 40px;
      }

      .subscription-card {
        border: 1px solid #ddd;
        padding: 30px;
        border-radius: 5px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        width: 350px;
        background-color: #ffffff;
      }

      .btn-primary {
        background-color: #0d6efd;
        border-color: #0d6efd;
        transition: background-color 0.3s, border-color 0.3s;
      }

      .btn-primary:hover {
        background-color: #0b5ed7;
        border-color: #0a58ca;
      }

      .form-select {
        width: 100%;
        padding: 10px;
        font-size: 1rem;
      }
      /* .optionSelect {
        padding: 3px;
        text-align: left;
        display: flex;
        justify-content: flex-start;
        font-size: 14px;
      } */

      .list-unstyled li {
        margin-bottom: 10px;
        font-size: 1rem;
      }
      .flex-container {
        display: flex;
        align-items: flex-start;
        padding: 4px;
      }

      @media (max-width: 992px) {
        .subscription-card {
          width: 300px;
        }
      }

      @media (max-width: 576px) {
        .subscription-card {
          width: 100%;
          margin: 10px 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <div class="page-wrapper" id="page-wrapper">
        <!-- Page Header -->
        <div class="page-header d-print-none">
          <div class="container-xl">
            <div class="row g-2 align-items-center">
              <div class="col">
                <h2 class="page-title text-center">Subscription Management</h2>
              </div>
            </div>
          </div>
        </div>

        <!-- Page Body -->
        <div class="page-body">
          <div class="container-xl">
            <div class="row row-cards">
              <!-- Basic Plan Card -->
              <div class="subscription-card">
                <div class="card-body text-center">
                  <div class="text-uppercase text-secondary font-weight-medium">
                    Basic
                  </div>
                  <div class="display-5 fw-bold my-3">120만원</div>
                  <ul class="list-unstyled lh-lg">
                    <li><strong>5</strong> Users</li>
                    <li>
                      <!-- Check Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-success"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M5 12l5 5l10 -10" />
                      </svg>
                      Sharing Tools
                    </li>
                    <li>
                      <!-- X Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-danger"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M18 6l-12 12" />
                        <path d="M6 6l12 12" />
                      </svg>
                      Design Tools
                    </li>
                    <li>
                      <!-- X Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-danger"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M18 6l-12 12" />
                        <path d="M6 6l12 12" />
                      </svg>
                      Private Messages
                    </li>
                    <li>
                      <!-- X Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-danger"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M18 6l-12 12" />
                        <path d="M6 6l12 12" />
                      </svg>
                      Twitter API
                    </li>
                  </ul>
                  <div class="text-center mt-4">
                    <button class="btn btn-primary w-100" id="basicSubscriptionButton" onclick="useBasicSubscription()">Register</a>
                  </div>
                </div>
              </div>
              <div class="subscription-card">
                <div class="card-body text-center">
                  <div class="text-uppercase text-secondary font-weight-medium">
                    Premium
                  </div>
                  <div class="display-5 fw-bold my-3">230만원</div>
                  <ul class="list-unstyled lh-lg">
                    <li><strong>20</strong> Users</li>
                    <li>
                      <!-- Check Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-success"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M5 12l5 5l10 -10" />
                      </svg>
                      Sharing Tools
                    </li>
                    <li>
                      <!-- Check Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-success"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M5 12l5 5l10 -10" />
                      </svg>
                      Design Tools
                    </li>
                    <li>
                      <!-- X Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-danger"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M18 6l-12 12" />
                        <path d="M6 6l12 12" />
                      </svg>
                      Private Messages
                    </li>
                    <li>
                      <!-- X Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-danger"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M18 6l-12 12" />
                        <path d="M6 6l12 12" />
                      </svg>
                      Twitter API
                    </li>
                  </ul>
                  <div class="text-center mt-4">
                    <button class="btn btn-primary w-100"  id="premiumSubscriptionButton"  onclick="usePremiumSubscription()">Register</a>
                  </div>
                </div>
              </div>
              <div class="subscription-card">
                <div class="card-body text-center">
                  <div class="text-uppercase text-secondary font-weight-medium">
                    Options Panel
                  </div>
                  <form id="optionForm">
                    <div class="mb-3">
                    <h3 class="flex-container"><label for="optionSelect">Add User: </label></h3>
                    <select id="optionSelect" class="form-select">
                      <option value="">Loading options ...</option>
                    </select>
                    </div>
                  <ul class="list-unstyled lh-lg">
                    <li><strong>As many you want</strong> (Users)</li>
                    <li>
                      <!-- Check Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-success"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M5 12l5 5l10 -10" />
                      </svg>
                      Sharing Tools
                    </li>
                    <li>
                      <!-- Check Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-success"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M5 12l5 5l10 -10" />
                      </svg>
                      Design Tools
                    </li>
                    <li>
                      <!-- Check Icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="icon me-1 text-success"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M5 12l5 5l10 -10" />
                      </svg>
                      Private Messages
                    </li>
                    <li>
                    
                    </li>
                  </ul>
                  <div class="mt-2 flex-container">
                    <span>Currently selected option:&nbsp;</span>
                    <span id="selectedOption"> None</span>
                  </div>
                 
                    <button
                      type="button"
                      class="btn btn-outline-secondary w-100"
                      onclick="addOption()"
                    >
                      Add
                    </button>
                  </form>
                </div>
              </form>
              </div>
              <div class="col-10">
                <div class="card card-md">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col">
                        <h2 class="h3">
                          Enterprise-ready. Reach out for a custom quote.
                        </h2>
                        <p class="m-0 text-secondary">
                          Tabler is designed to work great for large
                          enterprises. Take a look at our feature comparison.
                        </p>
                      </div>
                      <div class="col-auto">
                        <a href="mailto:example@gmail.com" class="btn">Book a demo </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- End of row-cards --> 
          </div>
        </div>
      </div>
    </div>
    <script>
      // Function to fetch all available options and populate the select element
      function fetchOptions() {
           $.ajax({
             type: "GET",
             url: "/ADMSRV001M0SelectAllOptions",
             async: true,
             dataType: "json",
             success: function (data) {
               console.log("Options fetched successfully:", data);
               var $optionSelect = $("#optionSelect");
               $optionSelect.empty();
               if (data.length > 0) {
                 $optionSelect.append(
                   '<option value="">Select an option</option>'
                 );
                 $.each(data, function (index, option) {
                   // Combine optCd and optDtlsCd as the value
                   var value = option.optCd + "|" + option.optDtlsCd;
                   $optionSelect.append(
                     '<option value="' +
                       value +
                       '">' +
                       option.optDtlsNm +
                       "</option>"
                   );
                 });
               } else {
                 $optionSelect.append(
                   '<option value="">No options available</option>'
                 );
               }
             },
             error: function (xhr, status, error) {
               console.error("Error fetching options:", status, error);
               $("#optionSelect").html(
                 '<option value="">Error loading options</option>'
               );
             },
           });
         }

         // Call fetchOptions when the page loads
         $(document).ready(function () {
           fetchOptions();
         });

         // Function to handle "Use" button click for Basic Subscription
         function useBasicSubscription() {
           $.ajax({
             type: "POST",
             url: "/ADMSRV001M0MergeServiceOption",
             async: true,
             dataType: "json",
             contentType: "application/json; charset=utf-8",
             xhrFields: {
               withCredentials: true,
             },
             data: JSON.stringify({
               srvcCd: "01", // Service code for Basic Subscription
             }),
             success: function (data) {
               console.log("Response data:", data);
               if (data.status === "success") {
                 alert("Basic Subscription activated successfully.");
                 console.log(
                   "Basic Subscription activation successful:",
                   data
                 );
                 // will update the ui accordingly 
                 $("#basicSubscriptionButton")
                   .text("Current Plan")
                   .prop("disabled", true);
                 $("#premiumSubscriptionButton")
                   .text("Register")
                   .prop("disabled", false);
               } else {
                 alert("Failed to activate the Basic Subscription service.");
               }
             },
             error: function (xhr, status, error) {
               console.error(
                 "Error activating Premium Subscription:",
                 xhr.responseText || status,
                 error
               );
               alert("Failed to activate Basic Subscription.");
             },
           });
         }

         // Function to handle "Use" button click for Premium Subscription
         function usePremiumSubscription() {
           $.ajax({
             type: "POST",
             url: "/ADMSRV001M0MergeServiceOption",
             async: true,
             dataType: "json",
             contentType: "application/json; charset=utf-8",
             xhrFields: {
               withCredentials: true,
             },
             data: JSON.stringify({
               srvcCd: "02", // Service code for Premium Subscription
             }),
             success: function (data) {
               console.log("Response data:", data);
               if (data.status === "success") {
                 alert("Premium Subscription activated successfully.");
                 console.log(
                   "Premium Subscription activation successful:",
                   data
                 );
                 // will update the ui to show the ui accordingly 
                 $("#premiumSubscriptionButton")
                   .text("Current Plan")
                   .prop("disabled", true);
                 $("#basicSubscriptionButton")
                   .text("Register")
                   .prop("disabled", false);
               } else {
                 alert("Failed to activate the Premium Subscription service.");
               }
             },
             error: function (xhr, status, error) {
               console.error(
                 "Error activating Premium Subscription:",
                 xhr.responseText || status,
                 error
               );
               alert("Failed to activate Premium Subscription.");
             },
           });
         }

         // Function to handle "Add" button click in Option Addition
         function addOption() {
           var selectedValue = $("#optionSelect").val();
           if (selectedValue === "") {
             alert("Please select an option to add.");
             return;
           }

           // Split the selected value to get optCd and optDtlsCd
           var codes = selectedValue.split("|");
           var optCd = codes[0];
           console.log("Console logging the optionCode code: ", codes[0]);
           var optDtlsCd = codes[1];
           console.log("Console logging the optioDeatils code: ", codes[1]);

           $.ajax({
             type: "POST",
             url: "/ADMSRV001M0UpdateOptionDetails",
             async: true,
             dataType: "json",
             contentType: "application/json; charset=utf-8",
             data: JSON.stringify({
               optCd: optCd, // Option Code
               optDtlsCd: optDtlsCd, // Option Details Code
             }),
             success: function (data) {
               console.log("Response data:", data);
               if (data.status === "success") {
                 alert("Option added successfully.");
                 console.log("Option addition successful:", data);
                 // Update the selected option display
                 $("#selectedOption").text(
                   $("#optionSelect option:selected").text()
                 );
               } else {
                 alert("Failed to add option.");
               }
             },
             error: function (xhr, status, error) {
               console.error("Error adding option:", status, error);
               alert("Failed to add option.");
             },
           });
         }

         // Function to fetch and display the user's current subscription info
         function getUserSubscriptionInfo() {
           $.ajax({
             type: "GET",
             url: "/getUserSubscriptionInfo",
             async: true,
             dataType: "json",
             success: function (data) {
               console.log("User subscription info:", data);
               // update the ui based on the user subscription 
               if (data && data.length > 0) {
                 var subscription = data[0]; // Assuming we hvae only one subscrition
                 if (subscription.srvcCd === "01") {
                   $("#basicSubscriptionButton")
                     .text("Current Plan")
                     .prop("disabled", true);
                   $("#premiumSubscriptionButton")
                     .text("Use")
                     .prop("disabled", false);
                 } else if (subscription.srvcCd === "02") {
                   $("#premiumSubscriptionButton")
                     .text("Current Plan")
                     .prop("disabled", true);
                   $("#basicSubscriptionButton")
                     .text("Use")
                     .prop("disabled", false);
                 } else {
                   $("#basicSubscriptionButton")
                     .text("Use")
                     .prop("disabled", false);
                   $("#premiumSubscriptionButton")
                     .text("Use")
                     .prop("disabled", false);
                 }

                 // Display the currently selected option
                 if (subscription.optDtlsNm) {
                   $("#selectedOption").text(subscription.optDtlsNm);
                 }
               } else {
                 // No subscription info found
                 $("#basicSubscriptionButton")
                   .text("Use")
                   .prop("disabled", false);
                 $("#premiumSubscriptionButton")
                   .text("Use")
                   .prop("disabled", false);
               }
             },
             error: function (xhr, status, error) {
               console.error(
                 "Error fetching user subscription info:",
                 status,
                 error
               );
             },
           });
         }

         // Call getUserSubscriptionInfo when the page loads
         $(document).ready(function () {
            getUserSubscriptionInfo();
          });
        </script>
      </div>
  </body>
</html>
