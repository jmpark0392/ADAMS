<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.rds.adams.web.biz.ins.dao.BIZINS002M0DAO">
    <select id="selectList" parameterType="com.rds.adams.web.biz.ins.dto.BIZINS002M0P0DTO" resultType="com.rds.adams.web.biz.ins.dto.BIZINS002M0R0DTO">
		SELECT
		       ROW_NUMBER() OVER(ORDER BY (SELECT 1)) AS ROW_NUMBER
		     , STD_YYMM
		     , INSC_DV_CD
		     , VALU_METD_CD
		     , PTF_CD
		     , BAS_AMT
		     , OCI_AMT
		     , NEW_CONT_AMT
		     , INT_EFFT_AMT
		     , ESTM_PRM
		     , ESTM_FEE
		     , ESTM_NEW_CONT_CCLS_AMT
		     , ESTM_FEE_RFND_AMT
		     , ESTM_CONT_MTN_AMT
		     , ESTM_IVSG_EXP_AMT
			 , ATS_ASSM_UPD_AMT
			 , EXRT_EFFT_AMT
			 , ENTM_AMT
		     , FRST_REG_EMP_NO  AS REG_USR_ID
		     , FRST_REG_DTM     AS REG_DT
		  FROM TB_INSU_PL_TTL_LST
         WHERE 1=1
           AND INSU_PL_CHNG_DV_CD = 'RA'
         <if test='searchTxt != ""'>
           AND (
                	STD_YYMM LIKE '%' + #{searchTxt} + '%'
                )
         </if>
    </select>
    <delete id="deleteListBf" parameterType="com.rds.adams.web.biz.ins.dto.BIZINS002M0P1DTO">
        DELETE FROM TB_INSU_PL_TTL_LST 
        WHERE STD_YYMM = '202406' AND INSU_PL_CHNG_DV_CD = 'RA'
    </delete>
    <insert id="insertList" parameterType="com.rds.adams.web.biz.ins.dto.BIZINS002M0P1DTO">
		INSERT INTO TB_INSU_PL_TTL_LST
		SELECT 
		       STD_YYMM
		     , 'O'                                   AS INSC_DV_CD 
		     , 'GMM'                                 AS VALU_METD_CD
		     , 'RA'                                  AS INSU_PL_CHNG_DV_CD
		     , PORTPOLIO                             
		     , SUM(BASE)                             AS BAS_AMT
		     , SUM(OCI)                              AS OCI_AMT
		     , SUM(ACQ_EXP_PREM_RLTED)               
		     + SUM(ACQ_EXP_PREM_NRLTED)              AS NEW_CONT_AMT
		     , SUM(INT_EFFT)                         AS INT_EFFT_AMT 
		     , SUM(PREM_GENERAL)                     
		     + SUM(PREM_OTHER)                       AS ESTM_PRM
		     , SUM(EXP_GENERAL)                      
		     + SUM(EXP_TAX)                          
		     + SUM(EXP_ASSET_POL_LOAN)               
		     + SUM(EXP_ASSET_REAL_EST)               
		     + SUM(EXP_ASSET_OTHER)                  AS ESTM_FEE
		     , SUM(ESTM_NEW_CONT_CCLS)               AS ESTM_NEW_CONT_CCLS_AMT
		     , SUM(INV_CMPNT_SURNDR)                 
		     + SUM(INV_CMPNT_MAT_BNFT)               
		     + SUM(INV_CMPNT_OTHER)                  AS ESTM_FEE_RFND_AMT
		     , SUM(CLAIM_ACCIDENT_DEATH)
		     + SUM(CLAIM_ACCIDENT_DIAGNOSIS_SURGERY)
		     + SUM(CLAIM_ACCIDENT_HOPSITALIZATION)
		     + SUM(CLAIM_ACCIDENT_OTHER)
		     + SUM(CLAIM_DISEASE_DEATH)
		     + SUM(CLAIM_DISEASE_DIAGNOSIS_SURGERY)
		     + SUM(CLAIM_DISEASE_HOPSITALIZATION)
		     + SUM(CLAIM_DISEASE_OTHER)
		     + SUM(CLAIM_MEDICAL)
		     + SUM(CLAIM_DISABILITY)
		     + SUM(CLAIM_INDEMNITY)
		     + SUM(CLAIM_OTHER)                      AS ESTM_CONT_MTN_AMT
		     , SUM(IVSG_EXP)                         AS ESTM_IVSG_EXP_AMT
		     , SUM(ATS_ASSM)                         AS ATS_ASSM_UPD_AMT
		     , SUM(EXRT_EFFT)                        AS EXRT_EFFT_AMT
		     , 0                                     AS ENTM_AMT
		     , '00002'                               AS REG_USRID
		     , GETDATE()                             AS REG_DT
		     , '00002'                               AS UPD_USRID
		     , GETDATE()                             AS UPD_DT
		  FROM TB_R3S_OUTPUT_RA_RST_LST 
		 WHERE STD_YYMM = '202406'
		 GROUP BY STD_YYMM, PORTPOLIO
    </insert>    
</mapper>